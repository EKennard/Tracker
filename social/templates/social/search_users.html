{% extends 'base.html' %}
{% block title %}Search Users{% endblock %}
{% block content %}

<h1 class="card" style="font-size:2rem;font-weight:bold;margin-bottom:1rem;">ğŸ” Find Friends</h1>

<div class="card" style="margin-bottom:1.5rem;">
  <form method="get" style="display:flex;gap:1rem;flex-wrap:wrap;">
    <input 
      type="text" 
      name="q" 
      value="{{ query }}" 
      placeholder="Enter personal key or username..." 
      class="form-input"
      style="flex:1;min-width:250px;"
      autofocus
    >
    <button type="submit" class="button">ğŸ” Search</button>
    <a href="{% url 'global_feed' %}" class="button" style="background:#999;text-decoration:none;">â† Back to Feed</a>
  </form>
  
  <div style="margin-top:1rem;padding:1rem;background:#E1F5FE;border-radius:0.5rem;font-size:0.9rem;">
    ğŸ’¡ <strong>Tip:</strong> Search by personal key (e.g., ABC123DEF456) or username to find friends!
  </div>
</div>

{% if query %}
  <div class="card">
    <h2 style="font-size:1.3rem;font-weight:bold;color:#4FC3F7;margin-bottom:1rem;">
      Search Results for "{{ query }}"
    </h2>
    
    {% if results %}
      <div style="display:flex;flex-direction:column;gap:1rem;">
        {% for user in results %}
        <div style="border:2px solid #4FC3F7;padding:1.5rem;border-radius:0.5rem;background:#F0F8FF;">
          <div style="display:flex;justify-content:space-between;align-items:center;flex-wrap:wrap;gap:1rem;">
            <div>
              <h3 style="margin:0 0 0.5rem 0;font-size:1.2rem;color:#BA68C8;">
                ğŸ‘¤ {{ user.user.username }}
              </h3>
              <div style="font-size:0.9rem;color:#666;">
                <span style="background:#E1F5FE;padding:0.25rem 0.75rem;border-radius:0.5rem;font-family:monospace;">
                  {{ user.personal_key }}
                </span>
              </div>
              {% if user.goal %}
                <p style="margin:0.5rem 0 0 0;color:#666;font-style:italic;">Goal: {{ user.goal }}</p>
              {% endif %}
              {% if user.is_public %}
                <span style="display:inline-block;margin-top:0.5rem;padding:0.25rem 0.75rem;background:#81C784;color:white;border-radius:0.5rem;font-size:0.85rem;">
                  ğŸŒ Public Profile
                </span>
              {% endif %}
            </div>
            
            <div>
              {% if user.friend_status == 'friends' %}
                <span style="padding:0.75rem 1.5rem;background:#81C784;color:white;border-radius:0.5rem;font-weight:bold;">
                  âœ“ Friends
                </span>
              {% elif user.friend_status == 'request_sent' %}
                <span style="padding:0.75rem 1.5rem;background:#FFB74D;color:white;border-radius:0.5rem;font-weight:bold;">
                  â³ Request Sent
                </span>
              {% elif user.friend_status == 'request_received' %}
                <a href="{% url 'friend_requests' %}" class="button" style="text-decoration:none;">
                  ğŸ“¬ View Request
                </a>
              {% else %}
                <a href="{% url 'send_friend_request' user.id %}" class="button" style="text-decoration:none;">
                  â• Add Friend
                </a>
              {% endif %}
            </div>
          </div>
        </div>
        {% endfor %}
      </div>
    {% else %}
      <div style="text-align:center;padding:3rem;color:#999;">
        <div style="font-size:3rem;margin-bottom:1rem;">ğŸ”</div>
        <p>No users found matching "{{ query }}"</p>
        <p style="font-size:0.9rem;margin-top:0.5rem;">Try searching with a different personal key or username.</p>
      </div>
    {% endif %}
  </div>
{% endif %}

{% endblock %}
