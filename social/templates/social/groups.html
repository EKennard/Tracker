{% extends 'base.html' %}
{% block title %}Groups{% endblock %}
{% block content %}

<div class="container py-4">
  {% if messages %}
  <div class="alert alert-success alert-dismissible fade show" role="alert">
    {% for message in messages %}
      {{ message }}
    {% endfor %}
    <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
  </div>
  {% endif %}

  <div class="d-flex justify-content-between align-items-center mb-4">
    <h1 class="mb-0">ðŸ‘¥ Groups</h1>
    <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#createGroupModal">+ Create Group</button>
  </div>

  <!-- Group Invitations -->
  {% if invitations %}
  <div class="card border-warning mb-4">
    <div class="card-header bg-warning bg-opacity-10">
      <h2 class="h5 mb-0">ðŸ“¨ Group Invitations ({{ invitations.count }})</h2>
    </div>
    <div class="card-body">
      <div class="list-group">
        {% for invitation in invitations %}
        <div class="list-group-item border-warning bg-warning bg-opacity-10">
          <div class="d-flex justify-content-between align-items-center flex-wrap gap-3">
            <div>
              <h5 class="mb-1">{{ invitation.group.name }}</h5>
              <small class="text-muted">Invited by {{ invitation.from_user.user.username }}</small>
            </div>
            <div class="btn-group">
              <a href="{% url 'accept_group_invitation' invitation.id %}" class="btn btn-success">âœ“ Accept</a>
              <a href="{% url 'decline_group_invitation' invitation.id %}" class="btn btn-danger">âœ— Decline</a>
            </div>
          </div>
        </div>
        {% endfor %}
      </div>
    </div>
  </div>
  {% endif %}

  <!-- Create Group Modal -->
  <div class="modal fade" id="createGroupModal" tabindex="-1">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">âž• Create New Group</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>
        <form method="post">
          {% csrf_token %}
          <div class="modal-body">
            {{ form.non_field_errors }}
            <div class="mb-3">
              <label for="{{ form.name.id_for_label }}" class="form-label">{{ form.name.label }}</label>
              <input type="text" name="{{ form.name.name }}" class="form-control" id="{{ form.name.id_for_label }}" value="{{ form.name.value|default:'' }}">
            </div>
            <div class="mb-3">
              <label for="{{ form.description.id_for_label }}" class="form-label">{{ form.description.label }}</label>
              <textarea name="{{ form.description.name }}" class="form-control" id="{{ form.description.id_for_label }}" rows="3">{{ form.description.value|default:'' }}</textarea>
            </div>
            <div class="mb-3 form-check">
              <input type="checkbox" name="{{ form.is_public.name }}" class="form-check-input" id="{{ form.is_public.id_for_label }}" {% if form.is_public.value %}checked{% endif %}>
              <label class="form-check-label" for="{{ form.is_public.id_for_label }}">
                Make group public (searchable)
              </label>
            </div>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
            <button type="submit" class="btn btn-primary">ðŸ’¾ Create Group</button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <!-- Your Groups -->
  <div class="card">
    <div class="card-header">
      <h2 class="h5 mb-0">My Groups ({{ my_groups.count }})</h2>
    </div>
    <div class="card-body">
      {% if my_groups %}
        <div class="row row-cols-1 row-cols-md-2 row-cols-lg-3 g-3">
          {% for group in my_groups %}
          <div class="col">
            <div class="card border-primary h-100">
              <div class="card-body">
                <h5 class="card-title text-primary">{{ group.name }}</h5>
                {% if group.description %}
                  <p class="card-text text-muted small">{{ group.description }}</p>
                {% endif %}
                <div class="d-flex justify-content-between align-items-center mt-3">
                  <small class="text-muted">ðŸ‘¤ {{ group.members.count }} member{{ group.members.count|pluralize }}</small>
                  <a href="{% url 'group_detail' group.id %}" class="btn btn-sm btn-outline-primary">View â†’</a>
                </div>
              </div>
            </div>
          </div>
          {% endfor %}
        </div>
      {% else %}
        <div class="text-center py-5 text-muted">
          <div class="display-1 mb-3">ðŸ‘¥</div>
          <p>You're not in any groups yet.</p>
      <p class="group-card-description">Create a group or wait for an invitation!</p>
    </div>
  {% endif %}
</div>

{% endblock %}