{% extends 'base.html' %}
{% block title %}Milestones{% endblock %}
{% block content %}

{% if messages %}
<div class="alert alert-secondary alert-dismissible fade show" role="alert">
  {% for message in messages %}
    {{ message }}
  {% endfor %}
  <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
</div>
{% endif %}

<div class="d-flex justify-content-between align-items-center mb-3">
  <h1 class="h3 mb-0"> Milestones</h1>
  <button class="btn btn-secondary" data-bs-toggle="modal" data-bs-target="#addMilestoneModal">+ Add Milestone</button>
</div>

<!-- Add Milestone Modal -->
<div class="modal fade" id="addMilestoneModal" tabindex="-1">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Add Milestone</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>
      <form method="post">
        {% csrf_token %}
        <div class="modal-body">
          {{ form.non_field_errors }}
          <div class="mb-3">
            <label for="{{ form.title.id_for_label }}" class="form-label">{{ form.title.label }}</label>
            {{ form.title }}
          </div>
          <div class="mb-3">
            <label for="{{ form.milestone_type.id_for_label }}" class="form-label">{{ form.milestone_type.label }}</label>
            {{ form.milestone_type }}
          </div>
          <div class="mb-3">
            <label for="{{ form.description.id_for_label }}" class="form-label">{{ form.description.label }}</label>
            {{ form.description }}
          </div>
          <div class="mb-3">
            <label for="{{ form.target_date.id_for_label }}" class="form-label">{{ form.target_date.label }}</label>
            {{ form.target_date }}
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
          <button type="submit" class="btn btn-secondary"> Save Milestone</button>
        </div>
      </form>
    </div>
  </div>
</div>
<div class="card">
  <h2 class="text-xl font-semibold mb-2">Your Milestones</h2>
  <table class="min-w-full table-auto">
    <thead>
      <tr class="bg-gray-200">
        <th class="px-2 py-1">Title</th>
        <th class="px-2 py-1">Type</th>
        <th class="px-2 py-1">Description</th>
        <th class="px-2 py-1">Target Date</th>
        <th class="px-2 py-1">Achieved</th>
      </tr>
    </thead>
    <tbody>
      {% for m in milestones %}
      <tr class="border-b">
        <td class="px-2 py-1">{{ m.title }}</td>
        <td class="px-2 py-1">{{ m.get_milestone_type_display }}</td>
        <td class="px-2 py-1">{{ m.description }}</td>
        <td class="px-2 py-1">{{ m.target_date }}</td>
        <td class="px-2 py-1">{% if m.date_achieved %}{{ m.date_achieved }}{% else %}<span class="text-gray-400">Not yet</span>{% endif %}</td>
        <td class="px-2 py-1">
          <a href="{% url 'share_item' 'milestones.milestone' m.id %}" class="text-blue-600 hover:underline">Share</a>
        </td>
      </tr>
      {% empty %}
      <tr><td colspan="5" class="text-center py-2">No milestones yet.</td></tr>
      {% endfor %}
    </tbody>
  </table>
</div>
{% endblock %}