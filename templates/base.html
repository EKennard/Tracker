{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}GetLizzyFit{% endblock %}</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="{% static 'css/cartoon-theme.css' %}">
    <link rel="stylesheet" href="{% static 'css/style.css' %}">
    {% block extra_head %}{% endblock %}
</head>
<body>
    {% if user.is_authenticated %}
        <header class="card" style="display:flex;flex-direction:column;align-items:center;justify-content:center;gap:0.15rem;text-align:center;padding:0.35rem;">
            <div style="display:flex;justify-content:center;align-items:center;">
                <img src="{% static 'icons/apple-doodle.svg' %}" class="icon" alt="Meals">
                <img src="{% static 'icons/heart-doodle.svg' %}" class="icon" alt="Health">
                <img src="{% static 'icons/checklist-doodle.svg' %}" class="icon" alt="Habits">
                <img src="{% static 'icons/calendar-doodle.svg' %}" class="icon" alt="Fertility">
                <img src="{% static 'icons/user-doodle.svg' %}" class="icon" alt="Profile">
            </div>
            <h1 style="font-family:'Fredoka One','Comic Neue',sans-serif;">
                <a href="/" style="color:#4FC3F7;text-decoration:none;">GetLizzyFit</a>
            </h1>
            <div class="user-info" style="display:flex;align-items:center;gap:0.25rem;">
                <span style="color:#BA68C8;font-size:0.95rem;font-weight:bold;">ğŸ‘¤ {{ user.username }}</span>
                <a href="/accounts/logout/" class="logout-button" style="background:#FF6B6B;color:white;padding:0.25rem 0.5rem;border-radius:0;text-decoration:none;font-weight:bold;box-shadow:0 1px 4px rgba(255,107,107,0.3);transition:all 0.3s;font-size:0.85rem;">ğŸšª Logout</a>
            </div>
        </header>
        
        {% if request.path != '/users/create-profile/' %}
        <!-- Burger Menu Button (Mobile) -->
        <button id="burger-menu" class="burger-menu" onclick="toggleMenu()" style="display:none;position:fixed;top:0.25rem;right:0.25rem;z-index:1001;background:#4FC3F7;border:2px solid #BA68C8;border-radius:0;width:40px;height:40px;cursor:pointer;box-shadow:0 2px 6px rgba(79,195,247,0.4);transition:all 0.3s;padding:0;">
            <div class="burger-icon">
                <span style="display:block;width:24px;height:2.5px;background:white;margin:4px auto;border-radius:2px;transition:all 0.3s;"></span>
                <span style="display:block;width:24px;height:2.5px;background:white;margin:4px auto;border-radius:2px;transition:all 0.3s;"></span>
                <span style="display:block;width:24px;height:2.5px;background:white;margin:4px auto;border-radius:2px;transition:all 0.3s;"></span>
            </div>
        </button>
        
        <!-- Navigation Menu -->
        <nav id="main-nav" class="card main-nav" style="display:flex;flex-wrap:wrap;gap:0.25rem;align-items:center;justify-content:center;margin-bottom:0.25rem;padding:0.25rem;">
            <a href="/users/dashboard/" class="button">ğŸ  Dashboard</a>
            
            <!-- Tracking Dropdown -->
            <div class="dropdown">
                <button class="button dropdown-btn" onclick="toggleDropdown(event, 'tracking-menu')">ğŸ“Š Tracking â–¼</button>
                <div id="tracking-menu" class="dropdown-content">
                    <a href="/meals/log/">ğŸ Meals</a>
                    <a href="/exercise/log/">ğŸ’ª Exercise</a>
                    <a href="/habits/log/">âœ… Habits</a>
                    <a href="/fertility/">ğŸŒ¸ Fertility</a>
                </div>
            </div>
            
            <!-- Progress Dropdown -->
            <div class="dropdown">
                <button class="button dropdown-btn" onclick="toggleDropdown(event, 'progress-menu')">ğŸ“ˆ Progress â–¼</button>
                <div id="progress-menu" class="dropdown-content">
                    <a href="/metrics/summary/">ğŸ“ Metrics</a>
                    <a href="/milestones/list/">ğŸ¯ Milestones</a>
                </div>
            </div>
            
            <!-- Social Dropdown -->
            <div class="dropdown">
                <button class="button dropdown-btn" onclick="toggleDropdown(event, 'social-menu')">ğŸ‘¥ Social â–¼</button>
                <div id="social-menu" class="dropdown-content">
                    <a href="/social/feed/">ğŸŒ Global Feed</a>
                    <a href="/social/search/">ğŸ” Find Friends</a>
                    <a href="/social/friend-requests/">ğŸ‘¥ My Friends</a>
                    <a href="/social/groups/">ğŸ‘« Groups</a>
                    <a href="/notifications/list/">ğŸ”” Notifications</a>
                </div>
            </div>
        </nav>
        {% endif %}
    {% else %}
        <header class="card" style="display:flex;flex-direction:column;align-items:center;justify-content:center;gap:0.25rem;text-align:center;">
            <div style="display:flex;justify-content:center;align-items:center;gap:0.5rem;">
                <img src="{% static 'icons/apple-doodle.svg' %}" class="icon" alt="Meals">
                <img src="{% static 'icons/heart-doodle.svg' %}" class="icon" alt="Health">
                <img src="{% static 'icons/checklist-doodle.svg' %}" class="icon" alt="Habits">
                <img src="{% static 'icons/calendar-doodle.svg' %}" class="icon" alt="Fertility">
                <img src="{% static 'icons/user-doodle.svg' %}" class="icon" alt="Profile">
            </div>
            <h1 style="margin-top:0.15rem;margin-bottom:0;font-family:'Fredoka One','Comic Neue',sans-serif;font-size:1.5rem;">
                <a href="/" style="color:#4FC3F7;text-decoration:none;">GetLizzyFit</a>
            </h1>
        </header>
        <nav class="card" style="display:flex;flex-wrap:wrap;gap:0.25rem;align-items:center;justify-content:center;margin-bottom:0.5rem;">
            <a href="/accounts/login/" class="button">Login</a>
        </nav>
    {% endif %}
    
    <!-- Django Messages - Fixed position overlay -->
    {% if messages %}
        <div id="messages-container">
            {% for message in messages %}
                <div class="toast-message message-{{ message.level_tag }}">
                    {{ message }}
                </div>
            {% endfor %}
        </div>
        <script>
            // Auto-fade messages after 3 seconds
            setTimeout(function() {
                const messages = document.querySelectorAll('.toast-message');
                messages.forEach(function(msg) {
                    msg.style.opacity = '0';
                    setTimeout(function() {
                        msg.remove();
                        const container = document.getElementById('messages-container');
                        if (container && container.children.length === 0) {
                            container.remove();
                        }
                    }, 500);
                });
            }, 3000);
        </script>
    {% endif %}
    
    <main class="main-section">
        {% block content %}
            {% if user.is_authenticated %}
                <div class="section-title">Welcome back, {{ user.username }}!</div>
            {% else %}
                <div class="welcome-title">Welcome to GetLizzyFit!</div>
                <div class="welcome-desc">
                    GetLizzyFit is your all-in-one health, fitness, and wellness tracker. Log your meals, track your habits, monitor your health metrics, and connect with friends for motivation. Our app helps you build healthy routines, celebrate milestones, and stay on top of your goals in a fun, supportive environment.
                </div>
                <div class="feature-card">
                    <img src="{% static 'icons/apple-doodle.svg' %}" class="feature-icon" alt="Meals">
                    <div class="feature-info">
                        <div class="feature-title">Meal Logging</div>
                        <div class="feature-desc">Easily log your daily meals, track nutrition, and spot healthy eating patterns.</div>
                    </div>
                </div>
                <div class="feature-card">
                    <img src="{% static 'icons/heart-doodle.svg' %}" class="feature-icon" alt="Health">
                    <div class="feature-info">
                        <div class="feature-title">Health Metrics</div>
                        <div class="feature-desc">Monitor your health stats, including weight, heart rate, and more, all in one place.</div>
                    </div>
                </div>
                <div class="feature-card">
                    <img src="{% static 'icons/checklist-doodle.svg' %}" class="feature-icon" alt="Habits">
                    <div class="feature-info">
                        <div class="feature-title">Habit Tracking</div>
                        <div class="feature-desc">Build and maintain healthy habits with daily tracking and reminders.</div>
                    </div>
                </div>
                <div class="feature-card">
                    <img src="{% static 'icons/calendar-doodle.svg' %}" class="feature-icon" alt="Fertility">
                    <div class="feature-info">
                        <div class="feature-title">Fertility & Calendar</div>
                        <div class="feature-desc">Track fertility cycles and important dates with our integrated calendar.</div>
                    </div>
                </div>
                <div class="feature-card">
                    <img src="{% static 'icons/user-doodle.svg' %}" class="feature-icon" alt="Profile">
                    <div class="feature-info">
                        <div class="feature-title">Social & Community</div>
                        <div class="feature-desc">Connect with friends, join groups, and celebrate milestones together.</div>
                    </div>
                </div>
            {% endif %}
        {% endblock %}
    </main>
    <footer style="text-align:center;margin-top:0.5rem;color:#81C784;font-size:0.85rem;">
        &copy; {{ now.year }} GetLizzyFit. All rights reserved.
    </footer>
    
    <script>
        // Toggle burger menu
        function toggleMenu() {
            const nav = document.getElementById('main-nav');
            const burger = document.getElementById('burger-menu');
            nav.classList.toggle('active');
            burger.classList.toggle('active');
        }
        
        // Toggle dropdown menus
        function toggleDropdown(event, menuId) {
            event.stopPropagation();
            const dropdown = event.target.closest('.dropdown');
            const allDropdowns = document.querySelectorAll('.dropdown');
            
            // Close other dropdowns
            allDropdowns.forEach(d => {
                if (d !== dropdown) {
                    d.classList.remove('active');
                }
            });
            
            // Toggle current dropdown
            dropdown.classList.toggle('active');
        }
        
        // Close dropdowns when clicking outside
        document.addEventListener('click', function(event) {
            if (!event.target.closest('.dropdown')) {
                document.querySelectorAll('.dropdown').forEach(d => {
                    d.classList.remove('active');
                });
            }
        });
        
        // Close mobile menu when clicking outside
        document.addEventListener('click', function(event) {
            const nav = document.getElementById('main-nav');
            const burger = document.getElementById('burger-menu');
            
            if (nav && burger && nav.classList.contains('active')) {
                if (!nav.contains(event.target) && !burger.contains(event.target)) {
                    nav.classList.remove('active');
                    burger.classList.remove('active');
                }
            }
        });
    </script>
    
    <!-- Bootstrap JS Bundle -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
