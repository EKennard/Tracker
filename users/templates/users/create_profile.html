{% extends "base.html" %}
{% load static %}
{% block title %}Create Your Profile{% endblock %}
{% block content %}
<style>
    /* Reduce spacing on profile creation page */
    body {
        padding-top: 0 !important;
    }
    
    .main-section {
        margin-top: 0.5rem !important;
        margin-bottom: 0.5rem !important;
        padding: 1.5rem !important;
    }
    
    header.card {
        margin-bottom: 0.5rem !important;
        padding: 0.75rem 1rem !important;
    }
    
    header h1 {
        font-size: 1.8rem !important;
        margin-top: 0.5rem !important;
    }
    
    header .icon {
        width: 36px !important;
        height: 36px !important;
    }
    
    .form-input {
        width: 100%;
        padding: 0.5rem;
        border: 2px solid #4FC3F7;
        border-radius: 0.5rem;
        font-size: 1rem;
        box-sizing: border-box;
    }
    
    /* Ensure all form inputs have consistent width */
    input[type="date"],
    input[type="text"],
    input[type="number"],
    select {
        width: 100% !important;
        padding: 0.5rem !important;
        border: 2px solid #4FC3F7 !important;
        border-radius: 0.5rem !important;
        font-size: 1rem !important;
        box-sizing: border-box !important;
    }
    .unit-toggle {
        display: flex;
        gap: 0.5rem;
        margin-bottom: 0.5rem;
        flex-wrap: wrap;
    }
    .unit-option {
        padding: 0.5rem 1rem;
        border: 2px solid #4FC3F7;
        border-radius: 0.5rem;
        cursor: pointer;
        background: white;
        transition: all 0.3s;
        font-size: 0.95rem;
        flex: 1;
        min-width: 120px;
    }
    .unit-option.active {
        background: #4FC3F7;
        color: white;
        font-weight: bold;
        box-shadow: 0 2px 8px rgba(79,195,247,0.3);
    }
    .unit-option:hover {
        background: #E1F5FE;
    }
    .unit-option.active:hover {
        background: #4FC3F7;
    }
    .input-group {
        display: flex;
        gap: 0.5rem;
        align-items: center;
    }
    .input-with-unit {
        position: relative;
    }
    .unit-label {
        position: absolute;
        right: 12px;
        top: 50%;
        transform: translateY(-50%);
        color: #999;
        font-size: 0.95rem;
        pointer-events: none;
    }
    .hidden {
        display: none;
    }
    .form-step {
        display: none;
    }
    .form-step.active {
        display: block;
        animation: fadeIn 0.3s;
    }
    @keyframes fadeIn {
        from { opacity: 0; transform: translateY(10px); }
        to { opacity: 1; transform: translateY(0); }
    }
    .step-indicator {
        display: flex;
        justify-content: center;
        gap: 0.5rem;
        margin-bottom: 2rem;
    }
    .step-dot {
        width: 12px;
        height: 12px;
        border-radius: 50%;
        background: #ddd;
        transition: all 0.3s;
    }
    .step-dot.active {
        background: #4FC3F7;
        width: 24px;
        border-radius: 6px;
    }
    .step-dot.completed {
        background: #81C784;
    }
    .btn-nav {
        padding: 0.75rem 1.5rem;
        border-radius: 0.5rem;
        font-weight: bold;
        cursor: pointer;
        transition: all 0.3s;
        border: none;
        font-size: 1rem;
    }
    .btn-next {
        background: #4FC3F7;
        color: white;
    }
    .btn-next:hover {
        background: #3BA5D8;
        transform: scale(1.05);
    }
    .btn-prev {
        background: #E1F5FE;
        color: #4FC3F7;
    }
    .btn-prev:hover {
        background: #B3E5FC;
    }
    .btn-skip {
        background: transparent;
        color: #999;
        text-decoration: underline;
    }
    .btn-skip:hover {
        color: #666;
    }
    .nav-buttons {
        display: flex;
        justify-content: space-between;
        gap: 1rem;
        margin-top: 1.5rem;
    }
    
    .welcome-title {
        font-size: 1.8rem !important;
        margin-bottom: 0.5rem !important;
    }
    
    .welcome-desc {
        font-size: 1rem !important;
        margin-bottom: 0.75rem !important;
    }
    
    .step-indicator {
        margin-bottom: 1rem !important;
    }
    
    .form-step h3 {
        margin-top: 0 !important;
        margin-bottom: 1rem !important;
        font-size: 1.3rem !important;
    }
    
    .form-step > div {
        margin-bottom: 1rem !important;
    }
    
    .form-step label {
        margin-bottom: 0.3rem !important;
    }
</style>

<div class="main-section" style="max-width:600px;margin:auto;">
    <div class="welcome-title" style="text-align:center;">Create Your Profile</div>
    <div class="welcome-desc" style="text-align:center;margin-bottom:0.5rem;">
        Tell us a bit about yourself to personalize your GetLizzyFit experience!
    </div>
    
    <!-- Step Indicator -->
    <div class="step-indicator">
        <div class="step-dot active" data-step="1"></div>
        <div class="step-dot" data-step="2"></div>
        <div class="step-dot" data-step="3"></div>
        <div class="step-dot" data-step="4"></div>
    </div>
    
    <form method="post" enctype="multipart/form-data" class="card" style="margin:auto;" id="profile-form">
        {% csrf_token %}
        
        {% if form.non_field_errors %}
            <div style="color:#E57373;margin-bottom:1rem;">
                {{ form.non_field_errors }}
            </div>
        {% endif %}
        
        <!-- Step 1: Basic Information -->
        <div class="form-step active" data-step="1">
            <h3 style="color:#4FC3F7;margin-top:0;margin-bottom:1.5rem;">üìã Basic Information</h3>
            
            <div style="margin-bottom:1.5rem;">
                <label style="display:block;margin-bottom:0.5rem;font-weight:bold;color:#4FC3F7;">Date of Birth *</label>
                {{ form.date_of_birth }}
                {% if form.date_of_birth.errors %}
                    <div style="color:#E57373;font-size:0.9rem;">{{ form.date_of_birth.errors }}</div>
                {% endif %}
                <div id="age-display" style="margin-top:0.5rem;color:#81C784;font-size:0.9rem;"></div>
            </div>
            
            <div style="margin-bottom:1.5rem;">
                <label style="display:block;margin-bottom:0.5rem;font-weight:bold;color:#4FC3F7;">Sex *</label>
                {{ form.sex }}
                {% if form.sex.errors %}
                    <div style="color:#E57373;font-size:0.9rem;">{{ form.sex.errors }}</div>
                {% endif %}
            </div>
            
            <div class="nav-buttons">
                <div></div>
                <button type="button" class="btn-nav btn-next" onclick="nextStep()">Next ‚Üí</button>
            </div>
        </div>
        
        <!-- Step 2: Body Metrics -->
        <div class="form-step" data-step="2">
            <h3 style="color:#4FC3F7;margin-top:0;margin-bottom:1.5rem;">üìè Body Metrics</h3>
            
            <div style="margin-bottom:1.5rem;">
                <label style="display:block;margin-bottom:0.5rem;font-weight:bold;color:#4FC3F7;">Weight Unit *</label>
                <div class="unit-toggle">
                    <button type="button" class="unit-option active" data-unit="kg" onclick="setWeightUnit('kg')">Kilograms (kg)</button>
                    <button type="button" class="unit-option" data-unit="lb" onclick="setWeightUnit('lb')">Pounds (lb)</button>
                    <button type="button" class="unit-option" data-unit="st" onclick="setWeightUnit('st')">Stones (st)</button>
                </div>
                {{ form.weight_unit }}
                {% if form.weight_unit.errors %}
                    <div style="color:#E57373;font-size:0.9rem;">{{ form.weight_unit.errors }}</div>
                {% endif %}
            </div>
            
            <div style="margin-bottom:1.5rem;">
                <label style="display:block;margin-bottom:0.5rem;font-weight:bold;color:#4FC3F7;">Starting Weight *</label>
                
                <div id="weight-kg" class="weight-input">
                    <div class="input-with-unit">
                        <input type="number" step="0.01" class="form-input" id="weight-input-kg">
                        <span class="unit-label">kg</span>
                    </div>
                </div>
                
                <div id="weight-lb" class="weight-input hidden">
                    <div class="input-with-unit">
                        <input type="number" step="0.01" class="form-input" id="weight-input-lb">
                        <span class="unit-label">lb</span>
                    </div>
                </div>
                
                <div id="weight-st" class="weight-input hidden">
                    <div class="input-group">
                        <input type="number" class="form-input" id="weight-stones-input" placeholder="Stones" style="width:48%;">
                        <span>st</span>
                        <input type="number" step="0.1" class="form-input" id="weight-pounds-input" placeholder="Pounds" style="width:48%;">
                        <span>lb</span>
                    </div>
                </div>
                
                {% if form.starting_weight.errors %}
                    <div style="color:#E57373;font-size:0.9rem;">{{ form.starting_weight.errors }}</div>
                {% endif %}
            </div>
            
            <div style="margin-bottom:1.5rem;">
                <label style="display:block;margin-bottom:0.5rem;font-weight:bold;color:#4FC3F7;">Height Unit *</label>
                <div class="unit-toggle">
                    <button type="button" class="unit-option active" data-unit="cm" onclick="setHeightUnit('cm')">Centimeters (cm)</button>
                    <button type="button" class="unit-option" data-unit="in" onclick="setHeightUnit('in')">Inches (in)</button>
                </div>
                {{ form.height_unit }}
                {% if form.height_unit.errors %}
                    <div style="color:#E57373;font-size:0.9rem;">{{ form.height_unit.errors }}</div>
                {% endif %}
            </div>
            
            <div style="margin-bottom:1.5rem;">
                <label style="display:block;margin-bottom:0.5rem;font-weight:bold;color:#4FC3F7;">Height *</label>
                
                <div id="height-cm" class="height-input">
                    <div class="input-with-unit">
                        <input type="number" step="0.01" class="form-input" id="height-input-cm">
                        <span class="unit-label">cm</span>
                    </div>
                </div>
                
                <div id="height-in" class="height-input hidden">
                    <div class="input-group">
                        <input type="number" class="form-input" id="height-feet-input" placeholder="Feet" style="width:48%;">
                        <span>ft</span>
                        <input type="number" step="0.1" class="form-input" id="height-inches-input" placeholder="Inches" style="width:48%;">
                        <span>in</span>
                    </div>
                </div>
                
                {% if form.height.errors %}
                    <div style="color:#E57373;font-size:0.9rem;">{{ form.height.errors }}</div>
                {% endif %}
            </div>
            
            <div class="nav-buttons">
                <button type="button" class="btn-nav btn-prev" onclick="prevStep()">‚Üê Previous</button>
                <button type="button" class="btn-nav btn-next" onclick="nextStep()">Next ‚Üí</button>
            </div>
        </div>
        
        <!-- Step 3: Activity Level -->
        <div class="form-step" data-step="3">
            <h3 style="color:#4FC3F7;margin-top:0;margin-bottom:1.5rem;">üí™ Activity Level</h3>
            
            <div style="margin-bottom:1.5rem;">
                <label style="display:block;margin-bottom:0.5rem;font-weight:bold;color:#4FC3F7;">Distance Unit *</label>
                {{ form.distance_unit }}
                {% if form.distance_unit.errors %}
                    <div style="color:#E57373;font-size:0.9rem;">{{ form.distance_unit.errors }}</div>
                {% endif %}
            </div>
            
            <div style="margin-bottom:1.5rem;">
                <label style="display:block;margin-bottom:0.5rem;font-weight:bold;color:#4FC3F7;">Activity Level *</label>
                <div style="background:#E1F5FE;border:2px dashed #4FC3F7;border-radius:0.5rem;padding:0.75rem;margin-bottom:0.75rem;font-size:0.85rem;">
                    <strong style="color:#4FC3F7;">üìã Guide:</strong>
                    <ul style="margin:0.5rem 0 0 1.25rem;padding:0;line-height:1.6;">
                        <li><strong>Sedentary:</strong> Little to no exercise, desk job</li>
                        <li><strong>Lightly Active:</strong> Light exercise 1-3 days/week</li>
                        <li><strong>Moderately Active:</strong> Moderate exercise 3-5 days/week</li>
                        <li><strong>Very Active:</strong> Hard exercise 6-7 days/week</li>
                        <li><strong>Extra Active:</strong> Very hard exercise, physical job or training twice/day</li>
                        <li><strong>Professional Athlete:</strong> Training multiple times daily at elite level</li>
                    </ul>
                </div>
                {{ form.activity_level }}
                {% if form.activity_level.errors %}
                    <div style="color:#E57373;font-size:0.9rem;">{{ form.activity_level.errors }}</div>
                {% endif %}
            </div>
            
            <div class="nav-buttons">
                <button type="button" class="btn-nav btn-prev" onclick="prevStep()">‚Üê Previous</button>
                <button type="button" class="btn-nav btn-next" onclick="nextStep()">Next ‚Üí</button>
            </div>
        </div>
        
        <!-- Step 4: Goals (Optional) -->
        <div class="form-step" data-step="4">
            <h3 style="color:#4FC3F7;margin-top:0;margin-bottom:1.5rem;">üéØ Your Goals (Optional)</h3>
            <p style="color:#666;margin-bottom:1.5rem;font-size:0.95rem;">Set your health and fitness goals to track your progress.</p>
            
            <div style="margin-bottom:1.5rem;">
                <label style="display:block;margin-bottom:0.5rem;font-weight:bold;color:#4FC3F7;">Goal Description</label>
                {{ form.goal }}
                {% if form.goal.errors %}
                    <div style="color:#E57373;font-size:0.9rem;">{{ form.goal.errors }}</div>
                {% endif %}
                <div style="font-size:0.85rem;color:#999;margin-top:0.25rem;">e.g., "Lose 10kg" or "Run 5km"</div>
            </div>
            
            <div style="margin-bottom:1.5rem;">
                <label style="display:block;margin-bottom:0.5rem;font-weight:bold;color:#4FC3F7;">Goal Weight (Optional)</label>
                <div class="input-with-unit" id="goal-weight-wrapper">
                    <input type="number" step="0.01" name="goal_weight" class="form-input" placeholder="Enter your target weight">
                    <span class="unit-label" id="goal-weight-unit">kg</span>
                </div>
                <div style="font-size:0.85rem;color:#999;margin-top:0.25rem;">What weight do you want to reach?</div>
            </div>
            
            <div style="margin-bottom:1.5rem;">
                <label style="display:block;margin-bottom:0.5rem;font-weight:bold;color:#4FC3F7;">Goal Deadline (Optional)</label>
                {{ form.deadline }}
                {% if form.deadline.errors %}
                    <div style="color:#E57373;font-size:0.9rem;">{{ form.deadline.errors }}</div>
                {% endif %}
                <div style="font-size:0.85rem;color:#999;margin-top:0.25rem;">When do you want to achieve this goal?</div>
            </div>
            
            <div style="margin-bottom:1.5rem;">
                <label style="display:flex;align-items:center;">
                    {{ form.is_public }}
                    <span style="margin-left:0.5rem;color:#4FC3F7;">Make my profile public (allow others to view my progress)</span>
                </label>
                {% if form.is_public.errors %}
                    <div style="color:#E57373;font-size:0.9rem;">{{ form.is_public.errors }}</div>
                {% endif %}
            </div>
            
            <div class="nav-buttons">
                <button type="button" class="btn-nav btn-prev" onclick="prevStep()">‚Üê Previous</button>
                <button type="submit" class="btn-nav btn-next">Create Profile ‚úì</button>
            </div>
        </div>
    </form>
</div>

<script>
    let currentStep = 1;
    const totalSteps = 4;
    
    // Multi-step form navigation with validation
    function nextStep() {
        // Validate current step before proceeding
        if (!validateCurrentStep()) {
            return;
        }
        
        if (currentStep < totalSteps) {
            // Hide current step
            document.querySelector(`.form-step[data-step="${currentStep}"]`).classList.remove('active');
            
            // Mark current as completed
            document.querySelector(`.step-dot[data-step="${currentStep}"]`).classList.add('completed');
            document.querySelector(`.step-dot[data-step="${currentStep}"]`).classList.remove('active');
            
            // Show next step
            currentStep++;
            document.querySelector(`.form-step[data-step="${currentStep}"]`).classList.add('active');
            document.querySelector(`.step-dot[data-step="${currentStep}"]`).classList.add('active');
            
            // Scroll to top
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }
    }
    
    // Validate required fields in current step
    function validateCurrentStep() {
        const currentStepElement = document.querySelector(`.form-step[data-step="${currentStep}"]`);
        let isValid = true;
        
        // Get all inputs and selects that have the 'required' attribute AND a 'name' attribute
        const allInputs = currentStepElement.querySelectorAll('input, select');
        allInputs.forEach(input => {
            // Only validate if:
            // 1. Has a name attribute (meaning it will be submitted)
            // 2. Has required attribute
            // 3. Is not in a hidden parent
            const hasName = input.hasAttribute('name');
            const isRequired = input.hasAttribute('required') || input.required;
            const isHidden = input.closest('.hidden') !== null;
            
            if (hasName && isRequired && !isHidden) {
                if (!input.value || input.value.trim() === '' || input.value === '-------') {
                    isValid = false;
                    input.style.borderColor = '#E57373';
                    input.style.borderWidth = '3px';
                    input.style.boxShadow = '0 0 0 2px rgba(229,115,115,0.2)';
                    console.log('Validation failed for:', input.name, 'value:', input.value);
                } else {
                    input.style.borderColor = '#4FC3F7';
                    input.style.borderWidth = '2px';
                    input.style.boxShadow = 'none';
                }
            }
        });
        
        if (!isValid) {
            // Show error message
            let errorDiv = currentStepElement.querySelector('.validation-error');
            if (!errorDiv) {
                errorDiv = document.createElement('div');
                errorDiv.className = 'validation-error';
                errorDiv.style.cssText = 'color:#E57373;background:#FFCDD2;padding:0.75rem;border-radius:0.5rem;margin-top:1rem;font-size:0.95rem;';
                errorDiv.textContent = '‚ö†Ô∏è Please fill in all required fields before continuing.';
                currentStepElement.insertBefore(errorDiv, currentStepElement.querySelector('.nav-buttons'));
            }
        } else {
            // Remove error message if exists
            const errorDiv = currentStepElement.querySelector('.validation-error');
            if (errorDiv) {
                errorDiv.remove();
            }
        }
        
        return isValid;
    }
    
    function prevStep() {
        if (currentStep > 1) {
            // Hide current step
            document.querySelector(`.form-step[data-step="${currentStep}"]`).classList.remove('active');
            document.querySelector(`.step-dot[data-step="${currentStep}"]`).classList.remove('active');
            
            // Show previous step
            currentStep--;
            document.querySelector(`.form-step[data-step="${currentStep}"]`).classList.add('active');
            document.querySelector(`.step-dot[data-step="${currentStep}"]`).classList.add('active');
            document.querySelector(`.step-dot[data-step="${currentStep}"]`).classList.remove('completed');
            
            // Scroll to top
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }
    }
    
    // Calculate and display age from date of birth
    function calculateAge() {
        const dobInput = document.querySelector('input[name="date_of_birth"]');
        const ageDisplay = document.getElementById('age-display');
        
        if (dobInput && dobInput.value) {
            const dob = new Date(dobInput.value);
            const today = new Date();
            let age = today.getFullYear() - dob.getFullYear();
            const monthDiff = today.getMonth() - dob.getMonth();
            
            if (monthDiff < 0 || (monthDiff === 0 && today.getDate() < dob.getDate())) {
                age--;
            }
            
            if (age >= 0 && age < 150) {
                ageDisplay.textContent = `Age: ${age} years old`;
            } else {
                ageDisplay.textContent = '';
            }
        }
    }
    
    // Set up DOB listener
    document.addEventListener('DOMContentLoaded', function() {
        const dobInput = document.querySelector('input[name="date_of_birth"]');
        if (dobInput) {
            dobInput.addEventListener('change', calculateAge);
            dobInput.addEventListener('input', calculateAge);
        }
    });
    
    // Weight unit toggle
    function setWeightUnit(unit) {
        console.log('Setting weight unit to:', unit);
        
        // Update hidden select
        document.querySelector('select[name="weight_unit"]').value = unit;
        
        // Update button styles - only for weight buttons
        const allLabels = Array.from(document.querySelectorAll('label'));
        const weightLabel = allLabels.find(l => l.textContent.trim() === 'Weight Unit *');
        if (weightLabel) {
            const weightContainer = weightLabel.nextElementSibling;
            const weightButtons = weightContainer.querySelectorAll('button[data-unit]');
            weightButtons.forEach(btn => {
                if (btn.getAttribute('data-unit') === unit) {
                    btn.classList.add('active');
                } else {
                    btn.classList.remove('active');
                }
            });
        }
        
        // Hide all weight input containers
        document.querySelectorAll('.weight-input').forEach(div => {
            div.classList.add('hidden');
        });
        
        // Remove name attribute from all weight inputs (so they won't submit)
        const kgInput = document.getElementById('weight-input-kg');
        const lbInput = document.getElementById('weight-input-lb');
        const stonesInput = document.getElementById('weight-stones-input');
        const poundsInput = document.getElementById('weight-pounds-input');
        
        kgInput.removeAttribute('name');
        kgInput.removeAttribute('required');
        lbInput.removeAttribute('name');
        lbInput.removeAttribute('required');
        stonesInput.removeAttribute('name');
        stonesInput.removeAttribute('required');
        poundsInput.removeAttribute('name');
        
        // Show and enable the appropriate input with name attribute
        if (unit === 'kg') {
            document.getElementById('weight-kg').classList.remove('hidden');
            kgInput.setAttribute('name', 'starting_weight');
            kgInput.setAttribute('required', 'required');
            console.log('Enabled kg input, has name:', kgInput.hasAttribute('name'), 'has required:', kgInput.hasAttribute('required'));
        } else if (unit === 'lb') {
            document.getElementById('weight-lb').classList.remove('hidden');
            lbInput.setAttribute('name', 'starting_weight');
            lbInput.setAttribute('required', 'required');
            console.log('Enabled lb input, has name:', lbInput.hasAttribute('name'));
        } else if (unit === 'st') {
            document.getElementById('weight-st').classList.remove('hidden');
            stonesInput.setAttribute('name', 'weight_stones');
            stonesInput.setAttribute('required', 'required');
            poundsInput.setAttribute('name', 'weight_pounds_extra');
            console.log('Enabled stones inputs');
        }
        
        // Update goal weight unit label
        const goalWeightLabel = document.getElementById('goal-weight-unit');
        if (goalWeightLabel) {
            goalWeightLabel.textContent = unit === 'st' ? 'st' : (unit === 'kg' ? 'kg' : 'lb');
        }
    }
    
    // Height unit toggle
    function setHeightUnit(unit) {
        console.log('Setting height unit to:', unit);
        
        // Update hidden select
        document.querySelector('select[name="height_unit"]').value = unit;
        
        // Update button styles - only for height buttons
        const heightContainer = Array.from(document.querySelectorAll('label')).find(l => l.textContent.includes('Height Unit')).nextElementSibling;
        const heightButtons = heightContainer.querySelectorAll('button[data-unit]');
        heightButtons.forEach(btn => {
            if (btn.getAttribute('data-unit') === unit) {
                btn.classList.add('active');
            } else {
                btn.classList.remove('active');
            }
        });
        
        // Hide all height input containers
        document.querySelectorAll('.height-input').forEach(div => {
            div.classList.add('hidden');
        });
        
        // Remove name attribute from all height inputs
        const cmInput = document.getElementById('height-input-cm');
        const feetInput = document.getElementById('height-feet-input');
        const inchesInput = document.getElementById('height-inches-input');
        
        cmInput.removeAttribute('name');
        cmInput.removeAttribute('required');
        feetInput.removeAttribute('name');
        feetInput.removeAttribute('required');
        inchesInput.removeAttribute('name');
        
        // Show and enable the appropriate input with name attribute
        if (unit === 'cm') {
            document.getElementById('height-cm').classList.remove('hidden');
            cmInput.setAttribute('name', 'height');
            cmInput.setAttribute('required', 'required');
            console.log('Enabled cm input, has name:', cmInput.hasAttribute('name'), 'has required:', cmInput.hasAttribute('required'));
        } else if (unit === 'in') {
            document.getElementById('height-in').classList.remove('hidden');
            feetInput.setAttribute('name', 'height_feet');
            feetInput.setAttribute('required', 'required');
            inchesInput.setAttribute('name', 'height_inches');
            console.log('Enabled inches inputs');
        }
    }
    
    // Hide the select dropdowns (they're controlled by buttons)
    document.addEventListener('DOMContentLoaded', function() {
        const weightSelect = document.querySelector('select[name="weight_unit"]');
        const heightSelect = document.querySelector('select[name="height_unit"]');
        
        if (weightSelect) {
            weightSelect.style.display = 'none';
        }
        if (heightSelect) {
            heightSelect.style.display = 'none';
        }
        
        // Initialize goal weight unit label to match default weight unit (kg)
        const goalWeightLabel = document.getElementById('goal-weight-unit');
        if (goalWeightLabel) {
            goalWeightLabel.textContent = 'kg';
        }
        
        // Initialize weight and height inputs - disable hidden ones
        setWeightUnit('kg');
        setHeightUnit('cm');
        
        // Debug: Log form submission data
        const form = document.getElementById('profile-form');
        form.addEventListener('submit', function(e) {
            console.log('Form submitting with data:');
            const formData = new FormData(form);
            for (let pair of formData.entries()) {
                console.log(pair[0] + ': ' + pair[1]);
            }
        });
    });
</script>
{% endblock %}
